<div class="agent-list-container">
	<div class="header">
		<h1>{{ 'AGENTS.AGENT_SETTINGS' | translate }}</h1>
		<div class="header-actions">
			<button class="back-button" (click)="goBackToChat()">
				<span class="icon">‚Üê</span>
				{{ 'COMMON.CHAT' | translate }}
			</button>
			<button class="refresh-button" (click)="refreshAgents()" [disabled]="loading$ | async">
				üîÑ {{ 'COMMON.LOADING' | translate }}
			</button>
			<button class="create-button" routerLink="/agents/new">
				<span class="icon">‚ú®</span>
				{{ 'AGENTS.CREATE_AGENT' | translate }}
			</button>
		</div>
	</div>

	@let loading = loading$ | async;

	@if (loading) {
		<div class="loading-indicator">
			<p>{{ 'COMMON.LOADING' | translate }}</p>
		</div>
	}

	@let agents = agents$ | async;

	@if (agents?.length === 0 && !loading) {
		<div class="empty-state">
			<p>{{ 'AGENTS.CREATE_FIRST_AGENT' | translate }}</p>
			<button routerLink="/agents/new">{{ 'AGENTS.CREATE_AGENT' | translate }}</button>
		</div>
	}

	@if (agents && agents.length > 0) {
		<div class="agent-grid">
			@for (agent of agents; track agent.id) {
				<div
					class="agent-card"
					[routerLink]="['/agents', agent.id]"
				>
					<div class="agent-header">
						<h2>{{ agent.name }}</h2>
						<div class="status" [class.active]="agent.isActive" [class.inactive]="!agent.isActive">
							{{ agent.isActive ? ('AGENTS.AGENT_ACTIVE' | translate) : ('AGENTS.AGENT_INACTIVE' | translate) }}
						</div>
						<div class="actions">
							<button
								class="edit-button"
								[routerLink]="['/agents/edit', agent.id]"
								(click)="$event.stopPropagation()"
							>
								{{ 'COMMON.EDIT' | translate }}
							</button>
							<button class="delete-button" (click)="deleteAgent(agent.id, $event)">
								{{ 'COMMON.DELETE' | translate }}
							</button>
						</div>
					</div>
					<div class="department">{{ agent.department }}</div>
					@if (agent.description) {
						<p class="description">{{ agent.description }}</p>
					} @else {
						<p class="no-description">{{ 'AGENTS.ENTER_AGENT_DESCRIPTION' | translate }}</p>
					}
					@if (agent.functions && agent.functions.length > 0) {
						<div class="functions">
							<span class="function-count">{{ agent.functions.length }} {{ 'AGENTS.AGENT_TOOLS' | translate }}</span>
						</div>
					}
					@if (agent.files && agent.files.length > 0) {
						<div class="files">
							<span class="file-count">{{ agent.files.length }} {{ 'CHAT.ATTACH_FILE' | translate }}</span>
						</div>
					}
					<div class="metadata">
						<span class="created-by">{{ 'COMMON.CREATE' | translate }}: {{ agent.createdBy.email }}</span>
						<span class="created-date">{{ 'COMMON.CREATE' | translate }}: {{ agent.createdAt | date: 'short' }}</span>
						@if (agent.updatedAt) {
							<span class="updated-date">{{ 'COMMON.EDIT' | translate }}: {{ agent.updatedAt | date: 'short' }}</span>
						}
					</div>
				</div>
			}
		</div>
	}
</div>
