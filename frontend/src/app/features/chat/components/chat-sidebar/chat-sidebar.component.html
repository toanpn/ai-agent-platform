<div class="sidebar-container">
	<div class="sidebar-header">
		<button mat-raised-button color="primary" (click)="onStartNewChat()">
			<mat-icon>add</mat-icon>
			{{ 'CHAT.NEW_CHAT' | translate }}
		</button>
		<button mat-button routerLink="/agents" class="manage-agents-button">
			<mat-icon>settings</mat-icon>
			{{ 'AGENTS.AGENT_SETTINGS' | translate }}
		</button>
	</div>

	<div class="agent-selector">
		<button mat-button [matMenuTriggerFor]="agentMenu" class="agent-selector-button">
			<mat-icon>person</mat-icon>
			<span>{{ selectedAgent()?.name || ('AGENTS.SELECT_MODEL' | translate) }}</span>
			<mat-icon>expand_more</mat-icon>
		</button>
		<mat-menu #agentMenu="matMenu">
			@for (agent of agents(); track agent.id) {
				<button mat-menu-item (click)="onSelectAgent(agent)">
					{{ agent.name }}
				</button>
			}
		</mat-menu>
	</div>

	<mat-divider></mat-divider>

	<div class="conversations-list">
        @let displayConversations = conversations();
		<mat-nav-list>
			@for (conversation of displayConversations; track conversation.id; let i = $index) {
				<a
					mat-list-item
					(click)="onSelectConversation(conversation)"
				>
					<div class="conversation-item">
						<mat-icon>chat</mat-icon>
						<div class="conversation-details">
							<div class="conversation-title">{{ conversation.title || 'Session ' + (i + 1) }}</div>
							<div class="conversation-time">
								{{ conversation.timestamp | date: 'short' }}
							</div>
						</div>
					</div>
				</a>
			}
		</mat-nav-list>

		@if (displayConversations?.length === 0) {
			<div class="empty-state">
				<p>{{ 'CHAT.NO_CONVERSATIONS' | translate }}</p>
			</div>
		}
	</div>

	<div class="sidebar-footer">
		@if (currentUser(); as user) {
			<div class="user-info">
				<mat-icon>account_circle</mat-icon>
				<div class="user-details">
					<div class="username">{{ user.username }}</div>
					<div class="email">{{ user.email }}</div>
				</div>
			</div>
		}
		<button mat-icon-button (click)="logout()" [matTooltip]="'COMMON.LOGOUT' | translate">
			<mat-icon>exit_to_app</mat-icon>
		</button>
	</div>
</div>
