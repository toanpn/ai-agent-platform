<div class="chat-input-wrapper" role="form" aria-label="Message input form">
	<mat-form-field appearance="outline" class="message-input">
		<mat-label>{{ 'CHAT.TYPE_MESSAGE' | translate }}</mat-label>
		<textarea
			matInput
			[placeholder]="'CHAT.TYPE_MESSAGE' | translate"
			[value]="messageText()"
			(input)="onMessageTextChanged($event)"
			(keydown)="onKeyDown($event)"
			[disabled]="disabled() || isEnhancing()"
			aria-label="Message text input"
			autocomplete="off"
			rows="3"
			cdkTextareaAutosize
			cdkAutosizeMinRows="1"
			cdkAutosizeMaxRows="5"
		></textarea>
		@if (disabled()) {
			<mat-hint>{{ 'COMMON.LOADING' | translate }}</mat-hint>
		}
		@if (isEnhancing()) {
			<mat-hint>{{ 'CHAT.ENHANCING_PROMPT' | translate }}</mat-hint>
		}
	</mat-form-field>

	<div class="input-actions">
		@if (isSpeechSupported) {
			<button
				mat-icon-button
				[color]="isListening() ? 'warn' : 'primary'"
				class="mic-button"
				(click)="toggleListening()"
				[matTooltip]="(isListening() ? 'CHAT.STOP_LISTENING' : 'CHAT.START_LISTENING') | translate"
				[attr.aria-label]="(isListening() ? 'CHAT.STOP_LISTENING' : 'CHAT.START_LISTENING') | translate"
				[disabled]="disabled() || isEnhancing()"
			>
				<mat-icon aria-hidden="true">{{ isListening() ? 'mic_off' : 'mic' }}</mat-icon>
			</button>
		}
		<button
			mat-icon-button
			color="accent"
			class="enhance-button"
			[disabled]="!messageText().trim() || disabled() || isEnhancing()"
			(click)="onEnhanceClick()"
			[matTooltip]="'CHAT.ENHANCE_PROMPT' | translate"
			[attr.aria-label]="'CHAT.ENHANCE_PROMPT' | translate"
		>
			@if (isEnhancing()) {
				<mat-spinner diameter="20" aria-hidden="true"></mat-spinner>
			} @else {
				<mat-icon aria-hidden="true">auto_fix_high</mat-icon>
			}
		</button>

		<button
			mat-fab
			color="primary"
			class="send-button"
			[disabled]="!messageText().trim() || disabled() || isEnhancing()"
			(click)="onSendClick()"
			[attr.aria-label]="'CHAT.SEND_MESSAGE' | translate"
		>
			<mat-icon aria-hidden="true">send</mat-icon>
		</button>
	</div>
</div>
